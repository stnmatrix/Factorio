"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}$(window).on("load",function(){$(".preloader").delay(2e3).fadeOut("slow"),$(".loader-container").delay(5e3).removeClass("hidden")}),$(function(){var g=this,h=$(".main-content .container"),j=$("#dir"),k=h.find(".sections .section"),l=$("<div class=\"section\"><pre></pre><div class=\"table-wrap\"><table class=\"table table-condensed section-table\"><thead><tr><td>VARIABLE NAME</td><td>EN</td><td>RU</td></tr></thead><tbody></tbody></table></div"),m="./result.php";function a(n,o){var p=$(".hidden_template").clone();p.removeClass("hidden_template").css("display","flex").appendTo(h),p.find(".file > pre").text(n).append("<i class=\"fa fa-sort-down\"></i>"),$.each(o,function(q,r){var s=l.clone(),t=s.find("tbody");s.find("pre").append(q).append("<i class=\"fa fa-sort-down\"></i>"),$.each(r,function(u,v){var w=$("<tr></tr>"),x="",y="";x=""===v.ru?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0435\u0440\u0435\u0432\u043E\u0434":v.ru,y=0===v.status?"Edit":1===v.status?"New!":"Non-edit",w.append("<td><span>"+v.var+"</span></td>"),w.append("<td><span>"+v.en+"</span></td>"),w.append("<td><span class='ru-translate' title="+y+">"+(""===v.ru?"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E":v.ru)+"</span><input type=\"text\" class=\"td-edit hidden invisible\" data-status="+v.status+" value=\""+(v.ru||""!==v.ru?v.ru.replace(/\"/g,"&quot;"):"")+"\"/></td>");var z=w.children("td").eq(2);switch(v.status){case 1:z.children("span.ru-translate").addClass("new"),w.addClass("bg");break;case 2:z.append("<i class=\"fa fa-trash-o\" title=\"Delete\"></i>"),z.children("span.ru-translate").addClass("old"),w.addClass("bg");}z.children(".td-edit").attr("placeholder",x),w.appendTo(t)}),s.appendTo(p.find(".sections"))})}function b(n){var o=$("<div class=\"content-error\"></div>"),p=$("<h1>"+n+"</h1>");o.append(p).addClass("blink"),h.html("").append(o)}function c(n,o){if(!n)return console.error("Value is not defined"),!1;var p=o.children("td").eq(1).text(),q=[];return $.each($(".sections tbody").find("tr"),function(r,s){var t=$(s).children("td").eq(1),u=t.text();if(p===u)if($(s).children("td").eq(2).text()!==o.children("td").eq(2).text()){var v=$(s).find(".ru-translate");v.text(n),q.push(v.siblings(".td-edit"))}else q.push(o.find(".td-edit"))}),q}function d(n,o,p){var q={},r=$(".selectize-dropdown-content > .option.selected.active").attr("data-value"),s=n.closest(".file").children("pre"),t=n.closest(".section").children("pre"),u=n.closest("tr").children("td").eq(0).children("span");q.dir=r,q.filename=s.text(),q.sectionname=t.text(),q.variablename=u.text(),"edit"===p?(q.ru=o||"",$.post(m,q,function(v,w,x){200===x.status?n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-success").delay(1400).queue(function(){$(this).removeClass("blink send-success").dequeue()}):n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")}).fail(function(){n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")})):"delete"===p&&(q.del="delete",$.post(m,q,function(v,w,x){200===x.status?n.closest("tr").hide(200).delay(200).queue(function(){$(this).detach().dequeue()}):n.closest("tr").addClass("blink send-error")}).fail(function(){n.closest("tr").addClass("blink send-error")}))}function e(n,o){if($(document).has(n)){return n.fadeToggle().toggleClass(o||""),n}}function f(n,o){if($(document).has(n)){return n.fadeToggle().toggleClass(o||"").focus(),n}}$.getJSON(m+"?getlist",function(n){var o=[];[]===n&&b("Empty response"),$.each(n,function(p,q){o.push($("<option value="+p+">"+q+"</option>")),j.append(o)}),j.on("change",function(){var p=$(g).find(":selected").val();$(".loader-container").addClass("hidden"),$(".main-content .container > *").addClass("hidden");$.getJSON(m+"?getdir="+p,function(r){var s=[];$.each(r,function(t){r&&""!==r?a(t,r[t]):b("Error at request content"),s=$("tbody:empty")}),$.each(s,function(t,u){$(u).closest(".table-wrap").slideToggle("fast"),$(u).closest(".section").find(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")})}).fail(function(r){r("Error at request content")})})}).done(function(){j.selectize({})}).fail(function(){b("Connection failed")}),h.on("click",".file pre",function(n){n.stopPropagation(),$(n.target).siblings(".sections").slideToggle(400),$(n.target).children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")}),h.on("click",".section pre",function(n){n.stopPropagation(),$(n.target).siblings(".table-wrap").slideToggle(400),$(n.target).has(".fa").toggleClass("fa-sort-up").toggleClass("fa-sort-down")}),h.on("click","tbody tr .ru-translate",function(n){n.stopPropagation();var o=$(n.target).siblings("input.td-edit"),p=$(n.target).closest("td").children("span"),q=h.find("input.td-edit.active"),r=q.closest("td").children("span.ru-translate");return!$(n.target).hasClass("old")&&void($(n.target).closest("tr").hasClass("blink send-error")&&$(n.target).closest("tr").removeClass("blink send-error"),q.hasClass("active")&&(f(q,"hidden invisible active"),e(r,"invisible hidden"),""!==q.val()&&q.val()!==r.text()&&(r.text(q.val()),d(q,q.val(),"edit"))),f(o,"hidden invisible active"),e(p,"invisible hidden"))}),h.on("keydown","tbody .td-edit",function(n){n.stopPropagation();var o=$(n.target).closest("td").children("span"),p=$(n.target).val();switch(n.which){case 13:if(e(o,"invisible hidden"),f($(n.target),"hidden invisible active"),""!==p&&p!==o.text()){var q=[];o.text(p),$(n.target).attr("placeholder",p),q=[].concat(_toConsumableArray(c(p,$(n.target).closest("tr")))),console.log(q),0<q.length&&$.each(q,function(r,s){s.val(p),s.attr("placeholder",p),d(s,p,"edit")})}break;case 27:e(o,"invisible hidden"),f($(n.target),"hidden invisible active"),$(n.target).val("");}}),$(document).on("click",function(n){var o=h.find(".td-edit.active"),p=o.closest("td").children(".ru-translate");h.has(n.target).length||(e(p,"invisible hidden"),f(o,"hidden invisible active"),o.val(p.text()))}),h.on("click",".section .fa-trash-o",function(n){n.stopPropagation(),d($(n.target),null,"delete");var o=$(n.target).closest(".file"),p=$(n.target).closest(".section"),q=$(n.target).closest("tbody");1>=q.find("tr").length&&(q.closest(".table-wrap").slideToggle(400),p.children("pre").children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up"))}),$(window).scroll(function(){1200<$(g).scrollTop()?$(".up").addClass("active"):400<$(g).scrollTop()?$(".down").addClass("active"):($(".up").removeClass("active"),$(".down").removeClass("active"))}),$(".up").on("click",function(){$("html, body").stop().animate({scrollTop:0},"slow","swing")}),$(".down").on("click",function(){var n=h.height();$("html, body").stop().animate({scrollTop:n},"slow","swing")})});