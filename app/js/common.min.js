"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}$(function(){var g=this,h=$(".main-content .container"),j=$("#dir"),k=h.find(".sections .section"),l=$("<div class=\"section\"><pre></pre><div class=\"table-wrap\"><table class=\"table table-condensed section-table\"><thead><tr><td>VARIABLE NAME</td><td>EN</td><td>RU</td></tr></thead><tbody></tbody></table></div"),m="./result.php",n=$.getJSON(m+"?getlist",function(o){var p=[];[]===o&&b("Empty response"),$.each(o,function(q,r){p.push($("<option value="+q+">"+r+"</option>")),j.append(p)}),j.on("change",function(){var q=$(g).find(":selected").val();$(".loader-container").addClass("hidden"),$(".main-content .container > *").addClass("hidden");$.getJSON(m+"?getdir="+q,function(s){var t=[];$.each(s,function(u){s&&""!==s?a(u,s[u]):b("Error at request content"),t=$("tbody:empty")}),$.each(t,function(u,v){$(v).closest(".table-wrap").slideToggle("fast"),$(v).closest(".section").find(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")})}).fail(function(s){s("Error at request content")})})}).done(function(){j.selectize({})}).fail(function(){b("Connection failed")});function a(o,p){var q=$(".hidden_template").clone();q.removeClass("hidden_template").css("display","flex").appendTo(h),q.find(".file > pre").text(o).append("<i class=\"fa fa-sort-down\"></i>"),$.each(p,function(r,s){var t=l.clone(),u=t.find("tbody");t.find("pre").append(r).append("<i class=\"fa fa-sort-down\"></i>"),$.each(s,function(v,w){var x=$("<tr></tr>"),y="";y=""===w.ru?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0435\u0440\u0435\u0432\u043E\u0434":w.ru,x.append("<td><span>"+w.var+"</span></td>"),x.append("<td><span>"+w.en+"</span></td>"),x.append("<td><span class='ru-translate' title="+(0===w.status?"Non-edit":"Edit")+">"+(""===w.ru?"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E":w.ru)+"</span><input type=\"text\" class=\"td-edit hidden invisible\" data-status="+w.status+" value=\""+(w.ru||""!==w.ru?w.ru.replace(/\"/g,"&quot;"):"")+"\"/></td>");var z=x.children("td").eq(2);switch(w.status){case 0:z.children("span.ru-translate").addClass("new"),x.addClass("bg");break;case 2:z.append("<i class=\"fa fa-trash-o\" title=\"Delete\"></i>"),z.children("span.ru-translate").addClass("old"),x.addClass("bg");}z.children(".td-edit").attr("placeholder",y),x.appendTo(u)}),t.appendTo(q.find(".sections"))})}function b(o){var p=$("<div class=\"content-error\"></div>"),q=$("<h1>"+o+"</h1>");p.append(q).addClass("blink"),h.html("").append(p)}function c(o,p){if(!o)return console.error("Value is not defined"),!1;var q=p.children("td").eq(1).text(),r=[];return $.each($(".sections tbody").find("tr"),function(s,t){var u=$(t).children("td").eq(1),v=u.text();if(q===v)if($(t).children("td").eq(2).text()!==p.children("td").eq(2).text()){var w=$(t).find(".ru-translate");w.text(o),r.push(w.siblings(".td-edit"))}else r.push(p.find(".td-edit"))}),r}function d(o,p,q){var r={},s=$(".selectize-dropdown-content > .option.selected.active").attr("data-value"),t=o.closest(".file").children("pre"),u=o.closest(".section").children("pre"),v=o.closest("tr").children("td").eq(0).children("span");r.dir=s,r.filename=t.text(),r.sectionname=u.text(),r.variablename=v.text(),"edit"===q?(r.ru=p||"",$.post(m,r,function(w,x,y){200===y.status?o.closest("tr").children("td:eq(2)").has("span").addClass("blink send-success").delay(1400).queue(function(){$(this).removeClass("blink send-success").dequeue()}):o.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")}).fail(function(){o.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")})):"delete"===q&&(r.del="delete",$.post(m,r,function(w,x,y){200===y.status?o.closest("tr").hide(200).delay(200).queue(function(){$(this).detach().dequeue()}):o.closest("tr").addClass("blink send-error")}).fail(function(){o.closest("tr").addClass("blink send-error")}))}function e(o,p){if($(document).has(o)){return o.fadeToggle().toggleClass(p||""),o}}function f(o,p){if($(document).has(o)){return o.fadeToggle().toggleClass(p||"").focus(),o}}h.on("click",".file pre",function(o){o.stopPropagation(),$(o.target).siblings(".sections").slideToggle(400),$(o.target).children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")}),h.on("click",".section pre",function(o){o.stopPropagation(),$(o.target).siblings(".table-wrap").slideToggle(400),$(o.target).has(".fa").toggleClass("fa-sort-up").toggleClass("fa-sort-down")}),h.on("click","tbody tr .ru-translate",function(o){o.stopPropagation();var p=$(o.target).siblings("input.td-edit"),q=$(o.target).closest("td").children("span"),r=h.find("input.td-edit.active"),s=r.closest("td").children("span.ru-translate");return!$(o.target).hasClass("old")&&void($(o.target).closest("tr").hasClass("blink send-error")&&$(o.target).closest("tr").removeClass("blink send-error"),r.hasClass("active")&&(f(r,"hidden invisible active"),e(s,"invisible hidden"),""!==r.val()&&r.val()!==s.text()&&(s.text(r.val()),d(r,r.val(),"edit"))),f(p,"hidden invisible active"),e(q,"invisible hidden"))}),h.on("keydown","tbody .td-edit",function(o){o.stopPropagation();var p=$(o.target).closest("td").children("span"),q=$(o.target).val();switch(o.which){case 13:if(e(p,"invisible hidden"),f($(o.target),"hidden invisible active"),""!==q&&q!==p.text()){var r=[];p.text(q),$(o.target).attr("placeholder",q),r=[].concat(_toConsumableArray(c(q,$(o.target).closest("tr")))),console.log(r),0<r.length&&$.each(r,function(s,t){t.val(q),t.attr("placeholder",q),d(t,q,"edit")})}break;case 27:e(p,"invisible hidden"),f($(o.target),"hidden invisible active"),$(o.target).val("");}}),$(document).on("click",function(o){var p=h.find(".td-edit.active"),q=p.closest("td").children(".ru-translate");h.has(o.target).length||(e(q,"invisible hidden"),f(p,"hidden invisible active"),p.val(q.text()))}),h.on("click",".section .fa-trash-o",function(o){o.stopPropagation(),d($(o.target),null,"delete");var p=$(o.target).closest(".file"),q=$(o.target).closest(".section"),r=$(o.target).closest("tbody");1>=r.find("tr").length&&(r.closest(".table-wrap").slideToggle(400),q.children("pre").children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up"))}),$(window).scroll(function(){1200<$(g).scrollTop()?$(".top").addClass("active"):$(".top").removeClass("active")}),$(".top").on("click",function(){$("html, body").stop().animate({scrollTop:0},"slow","swing")})}),$(window).on("load",function(){$(".preloader").delay(2e3).fadeOut("slow"),$(".loader-container").delay(5e3).removeClass("hidden")});