"use strict";$(function(){var a=this,b=$(".main-content .container"),c=$("#dir"),d=b.find(".sections .section"),e=$("<div class=\"section\"><pre></pre><div class=\"table-wrap\"><table class=\"table table-condensed section-table\"><thead><tr><td>VARIABLE NAME</td><td>EN</td><td>RU</td></tr></thead><tbody></tbody></table></div"),f="./result.php",g=$.getJSON(f+"?getlist",function(n){var o=[];$.each(n,function(p,q){o.push($("<option value="+p+">"+q+"</option>")),c.append(o)}),c.on("change",function(){var p=$(a).find(":selected").val();$(".loader-container").addClass("hidden"),$(".main-content .container > *").addClass("hidden");$.getJSON(f+"?getdir="+p,function(r){var s=[];$.each(r,function(t){r&&""!==r?h(t,r[t]):j("Error at request content"),s=$("tbody:empty")}),$.each(s,function(t,u){$(u).closest(".table-wrap").slideToggle("fast"),$(u).closest(".section").find(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")})}).fail(function(r){r("Error at request content")})})}).done(function(){c.selectize({})}).fail(function(){j("Connection failed")}),h=function renderContent(n,o){var p=$(".hidden_template").clone();p.removeClass("hidden_template").css("display","flex").appendTo(b),p.find(".file > pre").text(n).append("<i class=\"fa fa-sort-down\"></i>"),$.each(o,function(q,r){var s=e.clone(),t=s.find("tbody");s.find("pre").append(q).append("<i class=\"fa fa-sort-down\"></i>"),$.each(r,function(u,v){var w=$("<tr></tr>"),x="";x=""===v.ru?"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u0435\u0440\u0435\u0432\u043E\u0434":v.ru,w.append("<td><span>"+v.var+"</span></td>"),w.append("<td><span>"+v.en+"</span></td>"),w.append("<td><span class='ru-translate' title="+(0===v.status?"Non-edit":"Edit")+">"+(""===v.ru?"\u041D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u043E":v.ru)+"</span><input type=\"text\" class=\"td-edit hidden invisible\" data-status="+v.status+" value=\""+(v.ru||""!==v.ru?v.ru.replace(/\"/g,"&quot;"):"")+"\"/></td>");var y=w.children("td").eq(2);switch(v.status){case 1:y.children("span.ru-translate").addClass("new");break;case 2:y.append("<i class=\"fa fa-trash-o\" title=\"Delete\"></i>"),y.children("span.ru-translate").addClass("old");}y.children(".td-edit").attr("placeholder",x),w.appendTo(t)}),s.appendTo(p.find(".sections"))})},j=function error(n){var o=$("<div class=\"content-error\"></div>"),p=$("<h1>"+n+"</h1>");o.append(p).addClass("blink"),b.html("").append(o)},k=function sendValueToServer(n,o,p){var q={},r=$(".selectize-dropdown-content > .option.selected.active").attr("data-value"),s=n.closest(".file").children("pre"),t=n.closest(".section").children("pre"),u=n.closest("tr").children("td").eq(0).children("span");q.dir=r,q.filename=s.text(),q.sectionname=t.text(),q.variablename=u.text(),"edit"===p?(q.ru=o||"",$.post(f,q,function(v,w,x){200===x.status?n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-success").delay(1400).queue(function(){$(this).removeClass("blink send-success").dequeue()}):n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")}).fail(function(){n.closest("tr").children("td:eq(2)").has("span").addClass("blink send-error")})):"delete"===p&&(q.del="delete",$.post(f,q,function(v,w,x){200===x.status?n.closest("tr").hide(200).delay(200).queue(function(){$(this).detach().dequeue()}):n.closest("tr").addClass("blink send-error")}).fail(function(){n.closest("tr").addClass("blink send-error")}))},l=function showElement(n,o){if($(document).has(n)){return n.fadeToggle().toggleClass(o||""),n}},m=function hideElement(n,o){if($(document).has(n)){return n.fadeToggle().toggleClass(o||"").focus(),n}};b.on("click",".file pre",function(n){n.stopPropagation(),$(n.target).siblings(".sections").slideToggle(400),$(n.target).children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up")}),b.on("click",".section pre",function(n){n.stopPropagation(),$(n.target).siblings(".table-wrap").slideToggle(400),$(n.target).has(".fa").toggleClass("fa-sort-up").toggleClass("fa-sort-down")}),b.on("click","tbody tr .ru-translate",function(n){n.stopPropagation();var o=$(n.target).siblings("input.td-edit"),p=$(n.target).closest("td").children("span"),q=b.find("input.td-edit.active"),r=q.closest("td").children("span.ru-translate");return!$(n.target).hasClass("old")&&void($(n.target).closest("tr").hasClass("blink send-error")&&$(n.target).closest("tr").removeClass("blink send-error"),q.hasClass("active")&&(m(q,"hidden invisible active"),l(r,"invisible hidden"),""!==q.val()&&q.val()!==r.text()&&(r.text(q.val()),k(q,q.val(),"edit"))),m(o,"hidden invisible active"),l(p,"invisible hidden"))}),b.on("keydown","tbody .td-edit",function(n){n.stopPropagation();var o=$(n.target).closest("td").children("span"),p=$(n.target).val();switch(n.which){case 13:l(o,"invisible hidden"),m($(n.target),"hidden invisible active"),""!==p&&p!==o.text()&&(o.text(p),k($(n.target),p,"edit"));break;case 27:l(o,"invisible hidden"),m($(n.target),"hidden invisible active"),$(n.target).val("");}}),$(document).on("click",function(n){var o=b.find(".td-edit.active"),p=o.closest("td").children(".ru-translate");b.has(n.target).length||(l(p,"invisible hidden"),m(o,"hidden invisible active"),o.val(p.text()))}),b.on("click",".section .fa-trash-o",function(n){n.stopPropagation(),k($(n.target),null,"delete");var o=$(n.target).closest(".file"),p=$(n.target).closest(".section"),q=$(n.target).closest("tbody");1>=q.find("tr").length&&(q.closest(".table-wrap").slideToggle(400),p.children("pre").children(".fa").toggleClass("fa-sort-down").toggleClass("fa-sort-up"))}),$(window).scroll(function(){1200<$(a).scrollTop()?$(".top").addClass("active"):$(".top").removeClass("active")}),$(".top").on("click",function(){$("html, body").stop().animate({scrollTop:0},"slow","swing")})}),$(window).on("load",function(){$(".preloader").delay(2e3).fadeOut("slow"),$(".loader-container").delay(5e3).removeClass("hidden")});